<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0 text-dark">Dashboard</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                    <li class="breadcrumb-item active">Dashboard</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<section class="content">
    <div class="container-fluid">

        <div class="row">
            <div class="col-lg-3 col-6">
                <div class="small-box bg-info">
                    <div class="inner">
                        <h3>@ViewBag.CountOrderCancel</h3>
                        <p>New Order</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-bag"></i>
                    </div>
                    <a href="/admin/order/index" class="small-box-footer" target="_blank">View More<i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <div class="col-lg-3 col-6">
                <div class="small-box bg-success">
                    <div class="inner">
                        <h3>@ViewBag.CountOrderSuccess<sup style="font-size: 20px"></sup></h3>

                        <p>Completed Orders</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-stats-bars"></i>
                    </div>
                    <a href="/admin/order/index" class="small-box-footer" target="_blank">View More <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <div class="col-lg-3 col-6">
                <div class="small-box bg-warning">
                    <div class="inner">
                        <h3>@ViewBag.CountUser</h3>
                        <p>Member</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-person-add"></i>
                    </div>
                    <a href="/admin/account/index" class="small-box-footer" target="_blank">View More <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>
            <div class="col-lg-3 col-6">
                <div class="small-box bg-danger">
                    <div class="inner">
                        <h3>@ViewBag.CountContactDoneReply</h3>
                        <p>Unanswered Contact</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-pie-graph"></i>
                    </div>
                    <a href="/admin/contact/index" class="small-box-footer" target="_blank">View More <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-8" style="height: 400px;">
                <div>
                    <input type="date" id="fromDate" hidden />
                    <input type="date" id="toDate" hidden />
                    <a class="btn btn-secondary" onclick="getStatic()" hidden>View</a>
                </div>
                <canvas id="barChart"></canvas>
            </div>
            <div class="col-md-4">
                <table class="table table-bordered" style="margin-top: 30px;">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Date</th>
                            <th>Revenue</th>
                        </tr>
                    </thead>
                    <tbody id="load_data"></tbody>
                </table>
            </div>
        </div>
    </div>
</section>
<script src="~/Public/Admin/js/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://momentjs.com/downloads/moment.js"></script>
<script>
    var arrDoanhThu = [];
    var arrDate = [];

    $(document).ready(function () {
        // Bước 1: Xác định ngày hiện tại
        var ngayHienTai = new Date();

        // Bước 2: Giảm đi một tháng từ ngày hiện tại
        var ngayTruocMotThang = new Date();
        ngayTruocMotThang.setMonth(ngayTruocMotThang.getMonth() - 3);

        // Định dạng ngày thành chuỗi theo dd/MM/yyyy
        var ngayHienTaiStr = ngayHienTai.toISOString().slice(0, 10);
        var ngayTruocMotThangStr = ngayTruocMotThang.toISOString().slice(0, 10);;
        
        $('#fromDate').val(ngayTruocMotThangStr)
        $('#toDate').val(ngayHienTaiStr)

        getStatic()
    })

    function getStatic() {
        $.ajax({
            url: '/admin/dashboard/getstatistical',
            type: 'GET',
            data: { fromDate: $('#fromDate').val(), toDate: $('#toDate').val() },
            success: function (rs) {

                $.each(rs.Data, function (i, item) {
                    var strDate = moment(item.Date).format('DD/MM/yyyy')
                    arrDate.push(strDate)
                    arrDoanhThu.push(item.DoanhThu)
                })
                const ctx = document.getElementById('barChart');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: arrDate,
                        datasets: [{
                            label: 'Revenue',
                            data: arrDoanhThu,
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                load_data(rs.Data);
            }
        });

        function load_data(data) {
            var strHtml = '';
            $.each(data, function (i, item) {
                var strDate = moment(item.Date).format('DD/MM/yyyy')
                strHtml += '<tr>'
                strHtml += '<td>' + (i + 1) + '</td>'
                strHtml += '<td>' + strDate + '</td>'
                strHtml += '<td>' + item.DoanhThu + '</td>'
                strHtml += '</tr>'
            })
            $('#load_data').html(strHtml)
        }
    }
</script>
